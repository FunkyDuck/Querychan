#!/usr/bin/env php
<?php

use Dotenv\Dotenv;

$autoload = __DIR__ . '/../vendor/autoload.php';
$projectRoot = realpath(__DIR__ . '/..');

if(!file_exists($autoload)) {
    $autoload = __DIR__ . "/../../../autoload.php";
    $projectRoot = realpath(__DIR__ . "/../../..");
}
require_once $projectRoot . '/vendor/autoload.php';

if(class_exists(Dotenv::class) && file_exists($projectRoot . '/.env')) {
    $dotenv = Dotenv::createImmutable($projectRoot);
    $dotenv->load();
}

use FunkyDuck\Querychan\CLI\CommandDispatcher;
use FunkyDuck\Querychan\ORM\Database;

$argv = $_SERVER['argv'];
$argc = $_SERVER['argc'];

$dispatcher = new CommandDispatcher();
if(isset($argv[1])){
    $command = $argv[1];
    
    Database::connect();
    
    $dispatcher->handle($command, array_slice($argv, 2));
} 
else {
    $dispatcher->displayCommands();
}